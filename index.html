<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Box Blue Box</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="game-canvas" style="width: 100%; height: 100%;"></canvas>
    <script>class Pl{constructor(t,e,l){this.radius=l,this.color="lightgray",this.position={x:t,y:e}}draw(t,e,l){this.position.x=e,this.position.y=l,t.fillStyle=this.color,t.beginPath(),t.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!1),t.fill()}}class Tile{constructor(t,e,l,a){this.size=l,this.color=a,this.coords={x:t,y:e},this.posCoords={x:this.coords.x,y:this.coords.y},this.po={x:this.coords.x*tw+(canvas.width-tw*bL)/2,y:this.coords.y*tw+tw/2+(canvas.height-tw*(bH+1))/2}}}class Box extends Tile{draw(t){this.po={x:(this.po.x+this.coords.x*tw+(canvas.width-tw*bL)/2)/2,y:(this.po.y+this.coords.y*tw+tw/2+(canvas.height-tw*(bH+1))/2)/2},t.fillStyle=this.color,t.fillRect(this.po.x,this.po.y,this.size,this.size)}}class Pad extends Tile{draw(t){this.po={x:this.coords.x*tw+(canvas.width-tw*bL)/2,y:this.coords.y*tw+tw/2+(canvas.height-tw*(bH+1))/2},t.fillStyle=this.color,t.fillRect(this.po.x+this.size/10,this.po.y+this.size/10,.8*this.size,.8*this.size),t.fillStyle="#028090",t.fillRect(this.po.x+this.size/5,this.po.y+this.size/5,.6*this.size,.6*this.size)}}class Wall extends Tile{draw(t){this.po={x:this.coords.x*tw+(canvas.width-tw*bL)/2,y:this.coords.y*tw+tw/2+(canvas.height-tw*(bH+1))/2},t.fillStyle=this.color,t.fillRect(this.po.x-.6,this.po.y-.6,this.size+1.2,this.size+1.2)}}let canvas=document.getElementById("game-canvas"),ctx=canvas.getContext("2d");ctx.canvas.width=4*window.innerWidth,ctx.canvas.height=4*window.innerHeight;let player=new Pl(canvas.width/2,canvas.height/2,canvas.height/10);player.draw(ctx);var bL=5,bH=5;playX=0,playY=0,trX=0,trY=0,fade=0,completeOnce=!0;var l,lastTick=0,movX=!1,movY=!1,tw=canvas.height/8,levelNum=-1,spawn=[[0,0],[0,0],[0,1],[0,3],[0,0],[2,0],[0,0],[0,0],[0,0]],levels=[[[0,0,0,0,0],[0,0,0,0,0],[0,0,3,0,0],[0,0,0,0,0],[0,0,0,0,5]],[[0,0,0,0,0],[0,3,0,4,0],[0,0,0,0,0],[0,6,0,5,0],[0,0,0,0,0]],[[5,0,3,4,0,0,0],[0,0,3,4,0,0,0],[6,0,3,4,0,0,0]],[[0,0,0,2,2],[0,0,4,6,2],[0,4,3,5,6],[0,0,4,6,2],[0,0,0,2,2]],[[6,0,0,5],[0,3,4,0],[0,4,3,0],[5,0,0,6]],[[2,0,0,0,2],[0,4,3,5,0],[0,6,2,6,0],[0,5,3,4,0],[2,0,0,0,2]],[[5,0,0,2],[0,4,0,0],[0,3,3,0],[2,0,0,6]],[[0,0,0,0,0,0,0],[0,0,0,3,0,0,0],[0,0,2,2,2,2,0],[0,4,5,6,5,4,0],[0,2,2,2,2,0,0],[0,0,0,3,0,0,0],[0,0,0,0,0,0,0]],[[[5]]]];function nextLevel(){levelNum+=1,l=JSON.parse(JSON.stringify(levels[levelNum])),bH=l.length,bL=l[0].length,playX=spawn[levelNum][0],playY=spawn[levelNum][1],trX=playX,trY=playY;for(let t=0;t<bH;t++)for(let e=0;e<bL;e++)2==l[t][e]&&(l[t][e]=new Wall(e,t,tw,"#1A5E63"),l[t][e].coords.x=e,l[t][e].coords.y=t),3==l[t][e]&&(l[t][e]=new Box(e,t,tw,"#E23B3B"),l[t][e].coords.x=e,l[t][e].coords.y=t),4==l[t][e]&&(l[t][e]=new Box(e,t,tw,"#3C4CE0"),l[t][e].coords.x=e,l[t][e].coords.y=t),5==l[t][e]&&(l[t][e]=new Pad(e,t,tw,"#E23B3B"),l[t][e].coords.x=e,l[t][e].coords.y=t),6==l[t][e]&&(l[t][e]=new Pad(e,t,tw,"#3C4CE0"),l[t][e].coords.x=e,l[t][e].coords.y=t)}function drawBoxes(){var t=!0;for(let e=0;e<bH;e++)for(let a=0;a<bL;a++)l[e][a]instanceof Pad&&(t=t&&boxOnPad(e,a,l[e][a].color),l[e][a].size=tw,l[e][a].draw(ctx));for(let t=0;t<bH;t++)for(let e=0;e<bL;e++)(l[t][e]instanceof Box||l[t][e]instanceof Wall)&&(l[t][e].size=tw,l[t][e].draw(ctx));if(t&&completeOnce){completeOnce=!1;let t=!1,e=-50,l=setInterval(function(){e+=5,fade=t?(300-e)/100:e/100,!t&&e>=100&&(t=!0,nextLevel()),e>=300&&(completeOnce=!0,clearInterval(l))},10)}}function boxOnPad(t,e,a){for(let s=0;s<bH;s++)for(let o=0;o<bL;o++)if(l[s][o]instanceof Box&&l[s][o].coords.x==e&&l[s][o].coords.y==t&&l[s][o].color==a)return!0;return!1}function moveBoxes(t,e,a,s){for(let o=0;o<bH;o++)for(let i=0;i<bL;i++)if(l[o][i]instanceof Box&&l[o][i].coords.x==t&&l[o][i].coords.y==e){let c=l[o][i].coords.x+a,n=l[o][i].coords.y+s;0<=c&&c<=bL-1&&0<=n&&n<=bH-1?l[n][c]instanceof Wall?(moveBoxes(t-a,e-s,-a,-s),trX-=a,trY-=s):(moveBoxes(t+a,e+s,a,s),l[o][i].coords.x+=a,l[o][i].coords.y+=s):(moveBoxes(t-a,e-s,-a,-s),trX-=a,trY-=s)}}function check(t){switch(t.keyCode){case 37:playX>.9&&!(l[trY][trX-1]instanceof Wall)&&(trX-=1,moveBoxes(trX,trY,-1,0));break;case 38:playY>.9&&!(l[trY-1][trX]instanceof Wall)&&(trY-=1,moveBoxes(trX,trY,0,-1));break;case 39:playX<bL-1.1&&!(l[trY][trX+1]instanceof Wall)&&(trX+=1,moveBoxes(trX,trY,1,0));break;case 40:playY<bH-1.1&&!(l[trY+1][trX]instanceof Wall)&&(trY+=1,moveBoxes(trX,trY,0,1));break;case 82:levelNum-=1,nextLevel()}}function gameLoop(t){ctx.canvas.width=4*window.innerWidth,ctx.canvas.height=4*window.innerHeight,tw=canvas.height/8,player.radius=tw/2;lastTick=t,Math.abs(trY-playY)%1<le||1-le<Math.abs(trY-playY)%1<1+le&&!movY?(playX=(playX+trX)/2,movX=!(Math.abs(trX-playX)%1<le)):movX=!1,Math.abs(trX-playX)%1<le||1-le<Math.abs(trY-playY)%1<1+le&&!movX?(playY=(playY+trY)/2,movY=!(Math.abs(trY-playY)%1<le)):movY=!1,ctx.fillStyle="#1A5E63",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#028090",0==levelNum&&(ctx.font=`${Math.floor(canvas.width/24)}px Nunito`,ctx.fillText("Use arrow keys",(canvas.width-tw*bL)/4-canvas.width/7,canvas.height/2),ctx.fillText("       to move",(canvas.width-tw*bL)/4-canvas.width/7,canvas.height/2+Math.floor(canvas.width/24)),ctx.fillText("Retry with R",((canvas.width-tw*bL)/2+tw*bL+canvas.width)/2-canvas.width/9,canvas.height/2)),8==levelNum&&(ctx.font=`${Math.floor(canvas.width/24)}px Nunito`,ctx.fillText("Thanks for playing",(canvas.width-tw*bL)/4-canvas.width/7,canvas.height/2)),ctx.font=`${Math.floor(canvas.height/24)}px Nunito`,ctx.fillText(`Level ${levelNum+1}/${levels.length}`,(canvas.width-tw*bL)/2,(canvas.height-tw*bH)/2-15),ctx.fillRect((canvas.width-tw*bL)/2,(canvas.height-tw*bH)/2,tw*bL,tw*bH),drawBoxes(),player.draw(ctx,playX*tw+(canvas.width-tw*(bL-1))/2,playY*tw+tw/2+(canvas.height-tw*bH)/2),ctx.fillStyle=`rgba(26, 94, 99, ${fade})`,ctx.fillRect(0,0,canvas.width,canvas.height),requestAnimationFrame(gameLoop)}nextLevel(),window.addEventListener("keydown",this.check,!1),le=.1,requestAnimationFrame(gameLoop);</script>
</body>
</html>